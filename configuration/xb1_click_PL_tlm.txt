#Author: Peter Grenfell, Sept 2020 (inherits code from DeMi_COSMOS_Interface.git)
#Reference: https://cosmosrb.com/docs/v4/telemetry

# HK_SYS - System Housekeeping - APID: 0x312 (TBR)
TELEMETRY XACT PL_HK_SYS BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x312 "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ITEM HK_SYS_COUNTER 8 UINT
  APPEND_ITEM ENABLE_FLAGS 8 UINT
  APPEND_ITEM HK_FPGA_PERIOD 8 UINT
  APPEND_ITEM HK_SYS_PERIOD 8 UINT
  APPEND_ITEM CH_HEARTBEAT_PERIOD 8 UINT
  APPEND_ITEM PAT_HEALTH_PERIOD 8 UINT
  APPEND_ITEM FPGA_RESPONSE_PERIOD 8 UINT
  APPEND_ITEM ACK_CMD_COUNT 8 UINT
  APPEND_ITEM LAST_ACK_CMD_ID 8 UINT
  APPEND_ITEM ERROR_CMD_COUNT 8 UINT
  APPEND_ITEM LAST_ERROR_CMD_ID 8 UINT
  APPEND_ITEM BOOT_COUNT 32 UINT
  APPEND_ITEM DISK_USED_MEMORY 32 UINT
  APPEND_ITEM DISK_FREE_MEMORY 32 UINT
  APPEND_ITEM AVAILABLE_VIRTUAL_MEMORY 32 UINT
  APPEND_ARRAY_ITEM PL_VAR_DATA_AND_CRC 8 UINT -0 "Process information is variable length payload data + CRC"

# HK_PAT - PAT Housekeeping - APID: 0x313 (TBR)
TELEMETRY XACT PL_HK_PAT BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x313 "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ARRAY_ITEM PL_VAR_DATA_AND_CRC 8 UINT -0 "PAT health string is variable length payload data + CRC"

# HK_FPGA_MAP - FPGA Map Housekeeping - APID: 0x314 (TBR)
TELEMETRY XACT PL_HK_FPGA BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x314 "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ITEM HK_FPGA_COUNTER 8 UINT
  APPEND_ARRAY_ITEM PL_VAR_DATA_AND_CRC 8 UINT -0 "TBD variable length payload data + CRC"

# HK_CH - Commandhandler Housekeeping - APID: 0x315 (TBR)
TELEMETRY XACT PL_HK_CH BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x315 "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ARRAY_ITEM PL_VAR_DATA_AND_CRC 8 UINT -0 "CH health string is variable length payload data + CRC"

# DL_FILE - File Telemetry Chunks - APID: 0x387 (TBR)
TELEMETRY XACT PL_DL_FILE BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x387 "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ITEM TRANSFER_ID 16 UINT
  APPEND_ARRAY_ITEM FILE_MD5 8 UINT 128 "Original File MD5 Hash, bytewise"
    FORMAT_STRING "%01X"
  APPEND_ITEM CHUNK_SEQ_NUM 16 UINT "Chunk sequence number"
    FORMAT_STRING "0x%02X"
  APPEND_ITEM CHUNK_TOTAL_COUNT 16 UINT "Total chunk count"
    FORMAT_STRING "0x%02X"
  APPEND_ITEM CHUNK_DATA_LENGTH 16 UINT "Chunk data length (size in bytes)"
  APPEND_ARRAY_ITEM PL_VAR_DATA_AND_CRC 8 UINT -0 "Chunk data is variable length payload data + CRC"

# LIST_FILE - List payload directory file contents - APID: 0x3E0
TELEMETRY XACT PL_LIST_FILE BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x3E0 "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ARRAY_ITEM PL_VAR_DATA_AND_CRC 8 UINT -0 "File list data is variable length payload data + CRC"

# ASSEMBLE_FILE - Response from assemble file command - APID: 0x3B0
TELEMETRY XACT PL_ASSEMBLE_FILE BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x3B0 "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ITEM TRANSFER_ID 16 UINT
  APPEND_ITEM STATUS 8 UINT
  APPEND_ITEM MISSING_PACKETS_NUM 16 UINT "Number of missing packets"
  APPEND_ARRAY_ITEM PL_VAR_DATA_AND_CRC 8 UINT -0 "Missing packet IDs is variable length payload data + CRC"

# GET_FPGA - FPGA map register data from PL_GET_FPGA command - APID: 0x3C0 (Tested and Works)
TELEMETRY XACT PL_GET_FPGA BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x3C0 "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ITEM REQUEST_NUM 8 UINT "Request number"
  APPEND_ITEM START_ADDRESS 16 UINT "Register start address"
  APPEND_ITEM SIZE 8 UINT "Number of registers"
  APPEND_ARRAY_ITEM PL_VAR_DATA_AND_CRC 8 UINT -0 "Register data is variable length payload data + CRC"

# ECHO - Echo test - APID: 0x3FF (Tested and Works)
TELEMETRY XACT PL_ECHO BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x3FF "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ARRAY_ITEM PL_VAR_DATA_AND_CRC 8 UINT -0 "Echo string is variable length payload data + CRC"

# GENERAL_SELF_TEST - Payload general self test - APID: 0x3D0 (TBR)
TELEMETRY XACT PL_GENERAL_SELF_TEST BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x3D0 "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ARRAY_ITEM PL_VAR_DATA_AND_CRC 8 UINT -0 "TBD variable length payload data + CRC"

# LASER_SELF_TEST - Payload laser self test - APID: 0x3D1 (TBR)
TELEMETRY XACT PL_LASER_SELF_TEST BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x3D1 "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ARRAY_ITEM PL_VAR_DATA_AND_CRC 8 UINT -0 "TBD variable length payload data + CRC"

# PAT_SELF_TEST - Payload PAT self test (uses calibration laser) - APID: 0x3D2 (TBR)
TELEMETRY XACT PL_PAT_SELF_TEST BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x3D2 "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ITEM CAMERA_TEST_FLAG 8 UINT
  APPEND_ITEM FPGA_IPC_TEST_FLAG 8 UINT
  APPEND_ITEM LASER_TEST_FLAG 8 UINT
  APPEND_ITEM FSM_TEST_FLAG 8 UINT
  APPEND_ITEM CALIBRATION_TEST_FLAG 8 UINT
  APPEND_ARRAY_ITEM PL_VAR_DATA_AND_CRC 8 UINT -0 "Error messages are variable length payload data + CRC"