#Author: Peter Grenfell, Sept 2020 (inherits code from DeMi_COSMOS_Interface.git)
#Reference: https://cosmosrb.com/docs/v4/telemetry

# DL_FILE - File Telemetry Chunks - APID: 0x387 (TBR)
#TELEMETRY XACT DL_FILE BIG_ENDIAN
  #...
  #End COSMOS Header
#  APPEND_ARRAY_ITEM FILE_MD5 8 UINT 128 "Original File MD5 Hash, bytewise"
#    FORMAT_STRING "%01X"
#  APPEND_ITEM FILE_SEQ_NUM 16 UINT "File sequence number"
#    FORMAT_STRING "0x%02X"
#  APPEND_ITEM FILE_SEQ_CT 16 UINT "File sequence count"
#    FORMAT_STRING "0x%02X"
#  APPEND_ITEM DATA 32496 BLOCK "File Chunk Data"
#  APPEND_ITEM CH_SUM 16 UINT "Check sum (16 bit)"

# HK_CPU - CPU Housekeeping - APID: 0x312 (TBR)
#TELEMETRY XACT HK_CPU BIG_ENDIAN
  #...
  #End COSMOS Header
  #TBD Data 
  #APPEND_ITEM CH_SUM 16 UINT "Check sum (16 bit)"

# HK_PAT - PAT Housekeeping - APID: 0x313 (TBR)
#TELEMETRY XACT HK_CPU BIG_ENDIAN

  #End COSMOS Header
  #TBD Data 
  #APPEND_ITEM CH_SUM 16 UINT "Check sum (16 bit)"

# HK_FPGA_MAP - FPGA Map Housekeeping - APID: 0x314 (TBR)
#TELEMETRY XACT HK_CPU BIG_ENDIAN
  #...
  #End COSMOS Header
  #TBD Data 
  #APPEND_ITEM CH_SUM 16 UINT "Check sum (16 bit)"

# ECHO - Echo test - APID: 0x3FF
#TELEMETRY XACT ECHO BIG_ENDIAN
  #...
  #End Payload Header
  #APPEND_ITEM DATA 8 UINT "Echo data" 
  #APPEND_ITEM CH_SUM 16 UINT "Check sum (16 bit)"

#Test Telemetry (Tested & Works)
#TELEMETRY XACT EXAMPLE_PAYLOAD_DATA BIG_ENDIAN
  #...
  #End Payload Header
  #APPEND_ITEM PL_SINGLE_BYTE_TLM 8 UINT "Single byte of telemetry from payload"

TELEMETRY XACT PAYLOAD_TEST_DATA_1FF BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x1FF "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ARRAY_ITEM PL_DATA 8 UINT -0 "Payload data"

TELEMETRY XACT PAYLOAD_TEST_DATA_ECHO BIG_ENDIAN
  ITEM SYNC 0 64 UINT "Sync Pattern"
    FORMAT_STRING "0x%08X"
  ID_ITEM MSG_ID 64 32 UINT 0x3FF "Message ID – should be 0x300 – 0x3FF and unique for each pkt"
  ITEM LEN 96 32 UINT "Length (bytes) of packet"
  ITEM SEQ 128 32 UINT "Sequence Counter"
  ITEM CCSDS_TAI_SECS 160 32 UINT "TAI Seconds from CCSDS Header"
    UNITS sec sec
  ITEM CCSDS_TAI_SUBSECS 192 8 UINT "TAI Subseconds from CCSDS Header"
    POLY_READ_CONVERSION 0 0.2
    UNITS sec sec
  ITEM CCSDS_REALTIME 200 8 UINT "Identifies data as realtime or from storage"
    STATE REALTIME 1
    STATE STORED 0
  #End COSMOS Header
  APPEND_ITEM PL_CCSDS_VER 3 UINT
  APPEND_ITEM PL_CCSDS_TYPE 1 UINT
  APPEND_ITEM PL_CCSDS_SECNDRY 1 UINT
  APPEND_ITEM PL_CCSDS_APID 11 UINT "Same as message ID above"
    FORMAT_STRING "0x%03X"
  APPEND_ITEM PL_CCSDS_GRP 2 UINT
  APPEND_ITEM PL_CCSDS_SEQ 14 UINT
  APPEND_ITEM PL_CCSDS_LEN 16 UINT
  #End Payload Header
  APPEND_ARRAY_ITEM PL_DATA 8 UINT -0 "Payload data"
  
#File Telemetry (e.g. camera image, csv or txt file, etc.)
#TELEMETRY XACT PL_DWNLNK_FILE BIG_ENDIAN
#Header...
#End header
#APPEND_ITEM PL_SIZE 16 UINT "Payload Size" 
#APPEND_ITEM DATA 13600 BLOCK "Data"
#APPEND_ITEM CH_SUM 16 UINT "Check sum (16 bit)"

#DEMI:
#ID_ITEM ID_CODE 256 8 UINT 0xA4 "Packet ID code"
#  FORMAT_STRING "0x%01X"
#ITEM FILE_SEQ_NUM 272 16 UINT "File sequence number"
#  FORMAT_STRING "0x%02X"
#ITEM STAGED_TAI 288 32 UINT "Staged Time TAI Timestamp"
#  UNITS Seconds Sec
#ITEM GPS_PPS_AGE 320 16 UINT "Milliseconds since GPS PPS"
#  UNITS Milliseconds ms
#ITEM TRANSF_ID 336 16 UINT "Transfer ID"
#ITEM TOT_PACKETS 352 16 UINT "Total Packets #"
#ITEM PATH_NAME 368 2040 STRING "File Path/Name (255 bytes, fixed with trailing padding)"
#ARRAY_ITEM FILE_MD5 2408 8 UINT 128 "Original File MD5 Hash, bytewise"
#  FORMAT_STRING "%01X"

#Housekeeping Data Telemetry
#TELEMETRY XACT PAYLOAD_HOUSEKEEPING BIG_ENDIAN
#TBD

#DEMI:
# Common payload data header for TELEMETRY (file downlink differs):
#  ID_ITEM ID_CODE 256 8 UINT 0xA1 "Packet ID code"
# #   FORMAT_STRING "0x%01X"
#  ITEM SOURCE_PI 264 8 UINT "source PL, 1 or 2"
#    STATE PL_1 0x22
#    STATE PL_2 0x33
#  ITEM CUR_SD_CARD 272 8 UINT "current SD, A or B"
#    STATE SD-A 0xAA
#    STATE SD-B 0xBB
#  ITEM TLM_SEQ 280 32 UINT "telemetry sequence number"  # Note this tlm seq# != file downlink seq#
#    FORMAT_STRING "0x%02X"
#  ITEM GPS_TAI 312 32 UINT "GPS TAI Timestamp"
#    UNITS Seconds Sec
#  ITEM GPS_PPS_AGE 344 16 UINT "Milliseconds since GPS PPS"
#    UNITS milliseconds ms
#  ITEM PLM_MODE 360 8 UINT "current PLM Mode"
#    STATE IDLE 0xB5
#    STATE CAL_ALL 0xCA
#    STATE WFC_OPS 0xA1
#    STATE DEBUG 0x35
#    STATE SAFE 0x96